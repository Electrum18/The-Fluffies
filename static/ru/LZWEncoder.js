var U=-1;var j=12;var k=5003;var p=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function i(n,r,e,i){var f=Math.max(2,i);var t=new Uint8Array(256);var o=new Int32Array(k);var s=new Int32Array(k);var a,u=0;var l;var c=0;var b;var w=false;var _,h,m;function v(i,n){t[l++]=i;if(l>=254)x(n)}function g(i){y(k);c=h+2;w=true;M(h,i)}function y(i){for(var n=0;n<i;++n)o[n]=-1}function A(i,n){var r,e,f,t,a,u,v;_=i;w=false;n_bits=_;b=I(n_bits);h=1<<i-1;m=h+1;c=h+2;l=0;t=P();v=0;for(r=k;r<65536;r*=2)++v;v=8-v;u=k;y(u);M(h,n);i:while((e=P())!=U){r=(e<<j)+t;f=e<<v^t;if(o[f]===r){t=s[f];continue}else if(o[f]>=0){a=u-f;if(f===0)a=1;do{if((f-=a)<0)f+=u;if(o[f]===r){t=s[f];continue i}}while(o[f]>=0)}M(t,n);t=e;if(c<1<<j){s[f]=c++;o[f]=r}else{g(n)}}M(t,n);M(m,n)}function d(i){i.i(f);remaining=n*r;curPixel=0;A(f+1,i);i.i(0)}function x(i){if(l>0){i.i(l);i.t(t,0,l);l=0}}function I(i){return(1<<i)-1}function P(){if(remaining===0)return U;--remaining;var i=e[curPixel++];return i&255}function M(i,n){a&=p[u];if(u>0)a|=i<<u;else a=i;u+=n_bits;while(u>=8){v(a&255,n);a>>=8;u-=8}if(c>b||w){if(w){b=I(n_bits=_);w=false}else{++n_bits;if(n_bits==j)b=1<<j;else b=I(n_bits)}}if(i==m){while(u>0){v(a&255,n);a>>=8;u-=8}x(n)}}this.encode=d}module.u=i;